{{ if .Site.Params.gdpr }}
  <div id="cookie-popup" style="
  position: fixed;
  bottom: 30px; /* 微调bottom值，避免底部截断 */
  left: 50%;
  transform: translateX(-50%);
  max-width: 90%;
  width: 100%;
  max-width: 720px;
  background: #1f2937; /* 暗色模式背景 */
  color: #f3f4f6;      /* 暗色模式文字色 */
  padding: 20px 24px;
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.2);
  z-index: 9999;
  display: none;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  display: flex;
  flex-direction: column;
  gap: 16px;
  border: none; /* 强制清除边框 */
  overflow: hidden; /* 隐藏内部溢出内容（避免短线） */
">
    <!-- 文字区域 -->
    <p style="
      margin: 0;
      font-size: 15px;
      line-height: 1.6;
    ">
      We use cookies to enhance your experience, analyze traffic, and serve personalized ads. By using our site, you agree to our
      <a href="{{ .Site.Params.gdpr.cookiePolicyUrl }}" 
         style="color: {{ .Site.Params.color }}; font-weight: 500; text-decoration: none; border-bottom: 1px solid {{ .Site.Params.color }}50;"
         target="_blank">
        Cookie Policy
      </a>
      and
      <a href="{{ .Site.Params.gdpr.privacyPolicyUrl }}" 
         style="color: {{ .Site.Params.color }}; font-weight: 500; text-decoration: none; border-bottom: 1px solid {{ .Site.Params.color }}50;"
         target="_blank">
        Privacy Policy
      </a>.
    </p>

    <!-- 按钮区域（在弹窗内部，不会溢出） -->
    <div style="
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      justify-content: flex-end;
    ">
      <!-- 拒绝按钮 -->
      <button id="decline-non-necessary" style="
        background: #4b5563;
        color: #f3f4f6;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        min-width: 120px;
        transition: background 0.2s;
      " onmouseover="this.style.background='#6b7280'" onmouseout="this.style.background='#4b5563'">
        {{ .Site.Params.gdpr.declineButtonText }}
      </button>

      <!-- 同意按钮 -->
      <button id="accept-all-cookies" style="
        background: {{ .Site.Params.color }};
        color: white;
        border: none;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        min-width: 120px;
        transition: background 0.2s;
      " onmouseover="this.style.background='{{ .Site.Params.color | replace "2E7D32" "1B5E20" }}'" onmouseout="this.style.background='{{ .Site.Params.color }}'">
        {{ .Site.Params.gdpr.acceptButtonText }}
      </button>
    </div>
  </div>

  <script>
    (function() {
      const consentKey = 'cookieConsent';
      const popup = document.getElementById('cookie-popup');
      const acceptBtn = document.getElementById('accept-all-cookies');
      const declineBtn = document.getElementById('decline-non-necessary');

      // 初始隐藏弹窗（修复重复显示问题）
      popup.style.display = 'none';
      if (!localStorage.getItem(consentKey)) {
        popup.style.display = 'flex'; // 匹配flex布局
      }

      acceptBtn.addEventListener('click', function() {
        localStorage.setItem(consentKey, 'all');
        popup.style.display = 'none';
        {{ if .Site.Params.adsense.publisherId }}
          if (window.adsbygoogle) {
            (adsbygoogle = window.adsbygoogle || []).push({});
          }
        {{ end }}
      });

      declineBtn.addEventListener('click', function() {
        localStorage.setItem(consentKey, 'necessary');
        popup.style.display = 'none';
      });
    })();
  </script>
{{ end }}